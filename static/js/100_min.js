document.addEventListener("DOMContentLoaded",function(){function animateNumbers(){const numbers=document.querySelectorAll(".stats-number");numbers.forEach(element=>{const target=parseInt(element.getAttribute("data-target"));let current=0;const increment=target/50;const updateNumber=()=>{if(current<target){current+=increment;element.textContent=Math.ceil(current).toLocaleString();requestAnimationFrame(updateNumber)}else{element.textContent=target.toLocaleString()}};setTimeout(updateNumber,200)})}function launchFireworks(){const container=document.getElementById("firework-container");const colors=[getComputedStyle(document.documentElement).getPropertyValue("--primary-color").trim(),getComputedStyle(document.documentElement).getPropertyValue("--secondary-color").trim(),"#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff6b6b"];for(let i=0;i<5;i++){setTimeout(()=>{const startX=Math.random()*80+10;const launcher=document.createElement("div");launcher.className="firework-launcher";launcher.style.left=`${startX}%`;launcher.style.bottom="0";container.appendChild(launcher);setTimeout(()=>{if(launcher.parentNode){launcher.parentNode.removeChild(launcher)}const explosionX=startX;const explosionY=30+Math.random()*40;createExplosion(container,explosionX,explosionY,colors)},1e3)},i*400)}}function createExplosion(container,x,y,colors){const particleCount=50;for(let i=0;i<particleCount;i++){const particle=document.createElement("div");particle.className="firework-particle";const color=colors[Math.floor(Math.random()*colors.length)];particle.style.backgroundColor=color;particle.style.boxShadow=`0 0 8px ${color}`;particle.style.left=`${x}%`;particle.style.top=`${y}%`;const angle=Math.random()*Math.PI*2;const distance=Math.random()*100+50;const tx=Math.cos(angle)*distance;const ty=Math.sin(angle)*distance;particle.style.setProperty("--tx",`${tx}px`);particle.style.setProperty("--ty",`${ty}px`);const duration=Math.random()*1+.5;particle.style.animationDuration=`${duration}s`;container.appendChild(particle);setTimeout(()=>{if(particle.parentNode){particle.parentNode.removeChild(particle)}},duration*1e3)}}function createConfetti(){const container=document.getElementById("confetti-container");const colors=[getComputedStyle(document.documentElement).getPropertyValue("--primary-color").trim(),getComputedStyle(document.documentElement).getPropertyValue("--secondary-color").trim(),"#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff6b6b"];for(let i=0;i<100;i++){setTimeout(()=>{const confetti=document.createElement("div");confetti.className="confetti";confetti.style.left=Math.random()*100+"vw";confetti.style.top="-20px";const color=colors[Math.floor(Math.random()*colors.length)];confetti.style.backgroundColor=color;if(Math.random()>.5){confetti.style.borderRadius="50%"}const size=Math.random()*10+5;confetti.style.width=size+"px";confetti.style.height=size+"px";const animation=document.createElement("style");const animationName="confettiFall"+Date.now()+i;animation.textContent=`
                    @keyframes ${animationName} {
                        0% {
                            transform: translateY(0) rotate(0deg);
                            opacity: 1;
                        }
                        100% {
                            transform: translateY(100vh) rotate(${Math.random()*720-360}deg);
                            opacity: 0;
                        }
                    }
                `;document.head.appendChild(animation);confetti.style.animation=`${animationName} ${Math.random()*5+3}s linear forwards`;container.appendChild(confetti);setTimeout(()=>{if(confetti.parentNode){confetti.parentNode.removeChild(confetti)}document.head.removeChild(animation)},8e3)},i*100)}}let Barrages=fetch("/festival/100/barrage",{method:"GET"}).then(response=>response.json()).then(data=>data.barrages||[]);console.log("Barrages:",Barrages);async function initBarrage(){const barrageDisplay=document.getElementById("barrage-display");const barrageInput=document.getElementById("barrage-input");const sendButton=document.getElementById("send-barrage");Barrages=await Barrages;Barrages.forEach((text,index)=>{setTimeout(()=>{createBarrage(text)},index*1500)});sendButton.addEventListener("click",sendBarrage);barrageInput.addEventListener("keypress",function(e){if(e.key==="Enter"){sendBarrage()}});async function sendBarrage(){const text=barrageInput.value.trim();if(text){createBarrage(text,true);barrageInput.value="";fetch("/festival/100/barrage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:text})}).catch(err=>console.error("Failed to send barrage:",err));Barrages=await fetch("/festival/100/barrage",{method:"GET"}).then(response=>response.json()).then(data=>data.barrages||[])}}function createBarrage(text,isNew=false){const barrage=document.createElement("div");barrage.className="barrage-item position-absolute text-nowrap d-inline-block";barrage.textContent=text;const colors=["#9B59B6","#8A2BE2","#6A0DAD","#4ECDC4","#45B7D1","#96CEB4","#FECA57","#FF6B6B","#FF9FF3"];const color=colors[Math.floor(Math.random()*colors.length)];barrage.style.color=color;barrage.style.fontSize=Math.random()*8+14+"px";barrage.style.fontWeight=Math.random()>.7?"bold":"normal";barrage.style.textShadow="1px 1px 2px rgba(0,0,0,0.5)";barrage.style.padding="2px 10px";barrage.style.borderRadius="10px";if(isNew){barrage.style.border="1px solid #fff";barrage.style.boxShadow="0 0 8px rgba(255, 255, 255, 0.7)";barrage.style.backgroundColor="rgba(255, 255, 255, 0.1)";barrage.style.zIndex="10"}const trackHeight=30;const totalTracks=Math.floor(barrageDisplay.offsetHeight/trackHeight)-1;const track=Math.floor(Math.random()*totalTracks);const topPosition=track*trackHeight+5;barrage.style.top=topPosition+"px";barrage.style.left=barrageDisplay.offsetWidth+"px";barrageDisplay.appendChild(barrage);const textLength=text.length;const baseDuration=15;const duration=baseDuration+textLength*.1+Math.random()*5;barrage.animate([{transform:"translateX(0)"},{transform:`translateX(-${barrageDisplay.offsetWidth+barrage.offsetWidth}px)`}],{duration:duration*1e3,easing:"linear"}).onfinish=()=>{barrage.remove()}}}document.getElementById("launch-fireworks").addEventListener("click",function(){launchFireworks()});setTimeout(function(){initBarrage();launchFireworks();setTimeout(createConfetti,1500);animateNumbers()},1e3);setInterval(()=>{initBarrage()},5e3)});